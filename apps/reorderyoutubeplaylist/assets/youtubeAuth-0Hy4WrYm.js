const f="https://accounts.google.com/gsi/client",k="97231016307-dhbt66p60bd6s63loj6vsoat9pm299i6.apps.googleusercontent.com";let s=null,i=null,c=null;const l="ytp.google.token";function u(){try{const o=localStorage.getItem(l);if(!o)return null;const t=JSON.parse(o);if(!t?.accessToken||!t?.expiresAt)return null;if(Date.now()<t.expiresAt-6e4)return c=t.accessToken,c}catch{}return null}function m(o,t,e){c=o;const r=Date.now()+Math.max(1,t)*1e3,n={accessToken:o,expiresAt:r,scope:e};try{localStorage.setItem(l,JSON.stringify(n))}catch{}}function d(){return s||(s=new Promise((o,t)=>{const e=document.createElement("script");e.src=f,e.async=!0,e.defer=!0,e.onload=()=>o(),e.onerror=()=>t(new Error("GIS load failed")),document.head.appendChild(e)}),s)}async function h(o){const t=k,e=u();if(e)return e;await d();const r=window.google;if(i||(i=r.accounts.oauth2.initTokenClient({client_id:t,scope:o.join(" "),callback:n=>{if(n.error){console.error(n);return}const a=n.access_token,g=Number(n.expires_in??3600),w=n.scope||o.join(" ");m(a,g,w)}})),!c){i.requestAccessToken({prompt:"consent"});const n=Date.now();for(;!c;)if(await new Promise(a=>setTimeout(a,50)),Date.now()-n>2e4)throw new Error("permission-denied")}return c}function p(){c=null;try{localStorage.removeItem(l)}catch{}}async function T(){await d();const o=window.google,t=c||u();t&&o?.accounts?.oauth2?.revoke&&await new Promise(e=>{try{o.accounts.oauth2.revoke(t,()=>e())}catch{e()}}),p()}export{p as c,h as g,T as r};
